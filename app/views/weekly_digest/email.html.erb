<!--query the articles where include_in_digest = true, set them to false-->

<!--visit test page: paste this at end of URL: /rails/mailers/weekly_digest/sample_mail_preview -->

<!DOCTYPE html>
<html>
	<head>
		<meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
		
		<meta charset="UTF-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>CannabizNetwork</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		
		<!-- style on the page-->
		<style>
		
		    body {
		        font-family: 'Open Sans', sans-serif;
		        font-size: 12px;
		        color: #3b5265;
		        line-height: 1.7rem;
		        font-weight: 400;
		        -webkit-font-smoothing: antialiased;
		    }
    		
            .page-content > .row {
            margin-left: 0px !important;
            margin-right: 0px !important;
            margin-top: 30px;
            }
            
            .ptb-15 { padding: 15px 0 }
            .mt-40 { margin-top: 40px }
            .mb-40 { margin-bottom: 40px }
            
            .bg-white {
            background: #fff !important;
            }
            .bg-white p,
            .bg-white span,
            .bg-white ul,
            .bg-white a:not(.cat-btn), {
            color: #3b5265;
            }
            .bg-white h1:not(.header-color),
            .bg-white h2:not(.header-color),
            .bg-white h3:not(.header-color),
            .bg-white h4:not(.header-color),
            .bg-white h5:not(.header-color),
            .bg-white h6:not(.header-color),
            .bg-white i :not(.header-color){
            color: #2f2f2f;
            }
            
            .container {
                padding-right: 15px;
                padding-left: 15px;
                margin-right: auto;
                margin-left: auto;
            }
            
            .container:before,
            .container:after {
            display: table;
            content: " ";
            }
            
            .container:after {
            clear: both;
            }
            
            .row {
            margin-right: -15px;
            margin-left: -15px;
            }
            
            .col-md-4,
            .col-xs-12,
            .col-sm-12,
            .col-md-12,
            .col-lg-12 {
            position: relative;
            min-height: 1px;
            padding-right: 15px;
            padding-left: 15px;
            }
            
            .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 {
            float: left;
            width: 100%;
            }
            
            .section-title {
            position: relative;
            z-index: 1;
            }
            .section-title::after {
            bottom: 0;
            content: "";
            height: 1px;
            left: 0;
            position: absolute;
            width: 100%;
            z-index: -1;
            }
            .bg-white .section-title::after,
            .section-title::after {
            background: #e6e6e6 none repeat scroll 0 0;
            }
            
            .zm-posts .zm-post-lay-a1 {
            margin-bottom: 30px;
            }
            
            .clearfix:before,
            .clearfix:after {
            display: table;
            content: " ";
            }
            
            .zm-post-thumb img {
            width: 100%;
            height: 230px;
            border: .5px solid #7c8c99;
            }
            
            .zm-post-thumb a {
            display: block;
            }
            
            .zm-post-lay-a1 .zm-post-dis .h2.zm-post-title{
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            }
            
            .zm-post-header {
            padding: 25px 0 15px;
            }
            
            .zm-category {
            line-height: 1;
            height: 28px;
            overflow: hidden;
            }
            
            .bg-cat-3{
            background-color: #f2b718;
            }
            
            .cat-btn {
            border-radius: 2px;
            display: inline-block;
            font-family: roboto condensed;
            font-size: 12px;
            font-weight: 700;
            height: 20px;
            line-height: 20px;
            padding: 0 10px;
            position: relative;
            text-transform: uppercase;
            transition: all 0.3s ease 0s;
            z-index: 1;
            margin-bottom: 8px;
            color: #fff;
            }
            .cat-btn::before {
            background: #000 none repeat scroll 0 0;
            border-radius: 2px;
            content: "";
            height: 100%;
            left: 0;
            opacity: 0;
            position: absolute;
            top: 0;
            transition: all 0.3s ease 0s;
            width: 100%;
            z-index: -1;
            }
            .cat-btn:hover {
            color: #fff;
            }
            .cat-btn:hover::before {
            opacity: 0.2;
            }
            
            .zm-post-title {
            font-size: 20px;
            line-height: 30px;
            }
            
            .zm-post-lay-a1 .zm-post-meta {
            margin-top: 10px;
            }
            
            .s-meta {
            margin: auto 8px;
            padding: 0 8px;
            position: relative;
            display: inline-block;
            }
            .s-meta:first-child {
            margin-left: 0;
            padding-left: 0;
            }
            .s-meta:last-child {
            margin-right: 0;
            padding-right: 0;
            }
            
            .text-white .s-meta::after {
            color: #fff;
            }
            
            .zm-post-lay-a1 .zm-post-content p, .zm-post-lay-a1 .zm-post-content h2,
            .zm-post-lay-a1 .zm-post-content h3, .zm-post-lay-a1 .zm-post-content h4,
            .zm-post-lay-a1 .zm-post-content h5, .zm-post-lay-a1 .zm-post-content h6
            .zm-post-lay-a1 .zm-post-content {
                font-family: 'Open Sans', sans-serif;
                font-size: 12px;
                color: #3b5265;
                font-weight: 400;
                line-height: 1.7rem;
                margin: 0;
                padding: 0;
                display: inline-block;
            }
            
            
            .col-md-4 {
                width: 33.33333333333333%;
                float: left;
                position: relative;
                min-height: 1px;
                padding-right: 15px;
                padding-left: 15px;
            }
            
            .zm-posts .zm-post-lay-a1 {
                margin-bottom: 30px;
                max-height: 484px;
                overflow: hidden;
                position: relative;
            }
            
            @media (max-width: 991px) {
                .zm-post-thumb img {
                    height: auto;
                }
                
                .zm-posts .zm-post-lay-a1 {
                    max-height: none !important;
                }
            }
            
            /*responsive?*/
            @media (min-width: 768px) {
                .container {
                    width: 750px;
                }
            }
            @media (min-width: 992px) {
                .container {
                    width: 970px;
                }
            }
            @media (min-width: 1200px) {
                .container {
                    width: 1170px;
                }
            }
            @media (min-width: 1400px) {
                .container {
                    width: 1370px;
                }
            }
            @media (min-width: 1366px) {
                .container {
                    width: 1370px;
                }
            }
            
            
           
			
			
		</style>
	</head>
	<body>
		
		<div class="wrapper">
			
            <!-- Start page content -->
            <section id="page-content" class="page-wrapper archive">
                <div class="zm-section single-post-wrap archive-2 bg-white ptb-15">
                    <div class="container">
                        <div class="row">
                            <!-- Start left side -->
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 columns">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="archive-inner">
                                            <div class="archive-filter">
                                                <h3>The Cannabiz Network Weekly Roll Up</h3>
                                            </div>
                                        </div>
                                    </div>
                                </div>
            
                                
                                <div class="row mt-40">
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="row mb-40">
                                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="section-title">

                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="zm-posts clearfix">
                                                <% Article.where(include_in_digest: true).each do |article| %>
                                                
                                                    <div class="col-md-4">
                                                        <article class="zm-post-lay-a1">
                                                            
                                                            <!--save article-->
                                                            
                                                            <div class="zm-post-thumb">
                                                                <a href = 'http://cannabiz-news.herokuapp.com/articles/<%= article.id%>' target="_blank">
                                                                    <img src="<%=article.image%>" onerror="this.src='<%= asset_path 'homepage/news-substitute.jpg' %>'" alt="">
                                                                </a>
                                                            </div>
                                                            <div class="zm-post-dis">
                                                                <div class="zm-post-header">
                                                                    
                                                                    <!--display article tags-->
                                                                    <div class="zm-category">
                                                                        <% article.categories.each do |category| %>
                                                                            <a class="bg-cat-3 cat-btn" href = 'http://cannabiz-news.herokuapp.com/articles/<%= article.id%>' target="_blank"><%=category.name%></a>
                                                                        <% end %>
                                                                        <% article.states.each do |state| %>
                                                                            <a class="bg-cat-3 cat-btn" href = 'http://cannabiz-news.herokuapp.com/articles/<%= article.id%>' target="_blank"><%=state.name%></a>
                                                                        <% end %>
                                                                    </div>
                                                                    <!--display article tags-->
                                                                    
                                                                    <h2 class="zm-post-title"><a href = 'http://cannabiz-news.herokuapp.com/articles/<%= article.id%>' target="_blank"><%= article.title.truncate(60) if article.title %></a></h2>
                                                                    <div class="zm-post-meta">
                                                                        <ul>
                                                                            <li class="s-meta">
                                                                                <img class='inline' style='width: 40px; height: auto; display: none;' src = "<%= asset_path(article.source.sidebar_logo) if article.source %>">
                                                                                 <a class="zm-author" href = 'http://cannabiz-news.herokuapp.com/articles/<%= article.id%>' target="_blank"><%=article.source.name%></a>
                                                                            </li>
                                                                            <li class="s-meta"><p class="zm-date" style="color: #7c8c99;"><%= time_ago_in_words(article.created_at) %> ago</p></li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                                <div class="zm-post-content">
                                                                    
                                                                    <%frag = Nokogiri::HTML(article.body)%>
                                                                    <%frag.xpath("//h1").each { |div|  div.name= "p"}%>
                                                                    <%frag.xpath("//h2").each { |div|  div.name= "p"}%>
                                                                    <%frag.xpath("//h3").each { |div|  div.name= "p"}%>
                                                                    <%frag.xpath("//h4").each { |div|  div.name= "p"}%>
                                                                    <%frag.xpath("//h5").each { |div|  div.name= "p"}%>
                                                                    <%frag.xpath("//h6").each { |div|  div.name= "p"}%>
                                                                    
                                                                    <%= truncate_html frag, :length => 175 %>
                                    
                                                                </div>
                                                            </div>
                                                        </article>
                                                    </div>          
                                                    
                                                <% end %>
                                            </div>
                                            <div class = 'unsubscribe' style="border-top: 1px solid #e6e6e6; width: 98%; margin: 0 auto;">
            									<p>To Unsubscribe from this Digest, <%= link_to "Click Here", "cannabiz-news.herokuapp.com/unsubscribe?id=A43d#{@user.id}G2f4" %> </p>
            								</div>
                                        </div> <!-- end article display row
                                    </div>
                                </div>
                            </div>
                            <!-- End left side -->
                    </div>
                </div>
            </section>
            <!-- End page content -->			
			
		</div> <!-- end wrapper -->
	</body>
</html>